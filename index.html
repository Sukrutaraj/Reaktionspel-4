<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reaktionsspel – Retro Edition</title>

<style>
:root {
    --bg-color: #000;
    --circle-gray: #333;
    --circle-green: #00ff66;
    --circle-red: #ff0033;
    --circle-yellow: #ffeb3b;
    --text-color: #ffffff;
}

html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    background: var(--bg-color);
    font-family: Arial, Helvetica, sans-serif;
    color: var(--text-color);
    overflow: hidden;
}

.container {
    height: 100vh;
    display: flex;
    flex-direction: column;
    padding: 10px;
    box-sizing: border-box;
}

.start-screen {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 20px;
}

.start-screen button {
    font-size: 1.5rem;
    padding: 15px 30px;
    border-radius: 10px;
    border: none;
}

.header {
    text-align: center;
    margin-bottom: 8px;
}

.score {
    font-size: 2rem;
    font-weight: bold;
}

.message {
    font-size: 1.2rem;
}

.grid-wrapper {
    flex: 1;
    display: flex;
}

.grid {
    flex: 1;
    display: grid;
    gap: 4px;
}

.circle {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    border: none;
    background-color: var(--circle-gray);
}

.circle.green { background-color: var(--circle-green); }
.circle.red { background-color: var(--circle-red); }
.circle.yellow { background-color: var(--circle-yellow); }

</style>
</head>

<body>
<div class="container">

<div class="start-screen" id="startScreen">
    <h1>Retro Reaktionsspel</h1>
    <button onclick="startGame(1)">Nivå 1</button>
    <button onclick="startGame(2)">Nivå 2</button>
    <button onclick="startGame(3)">Nivå 3</button>
</div>

<div id="gameArea" style="display:none; flex:1; flex-direction:column;">
    <div class="header">
        <div class="score" id="scoreText">Poäng: 0</div>
        <div class="message" id="messageText"></div>
    </div>
    <div class="grid-wrapper">
        <div class="grid" id="gameGrid"></div>
    </div>
</div>

</div>

<script>
const GAME_TIME = 20;
const COLUMNS = 10;
const ROWS = 6;

let score = 0;
let timeLeft = GAME_TIME;
let timer = null;
let level = 1;

let activeGreen = -1;
let activeRed = -1;
let activeYellow = -1;

const startScreen = document.getElementById("startScreen");
const gameArea = document.getElementById("gameArea");
const grid = document.getElementById("gameGrid");
const scoreText = document.getElementById("scoreText");
const messageText = document.getElementById("messageText");

grid.style.gridTemplateColumns = `repeat(${COLUMNS}, 1fr)`;
grid.style.gridTemplateRows = `repeat(${ROWS}, 1fr)`;

/* Skapa cirklar */
for (let i = 0; i < COLUMNS * ROWS; i++) {
    const btn = document.createElement("button");
    btn.classList.add("circle");
    btn.dataset.index = i;
    grid.appendChild(btn);
}
const circles = document.querySelectorAll(".circle");

/* =========================
   RETRO LJUD (Web Audio)
   ========================= */
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function playTone(freq, duration, type="square") {
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = type;
    osc.frequency.value = freq;
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start();
    gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
    osc.stop(audioCtx.currentTime + duration);
}

function soundGreen() {
    playTone(880, 0.08);
}

function soundYellow() {
    playTone(880, 0.08);
    setTimeout(()=> playTone(1200, 0.12), 80);
}

function soundRed() {
    playTone(150, 0.2, "sawtooth");
}

/* ========================= */

function setTargets() {
    circles.forEach(c => c.classList.remove("green","red","yellow"));

    activeGreen = Math.floor(Math.random() * circles.length);
    circles[activeGreen].classList.add("green");

    activeRed = -1;
    activeYellow = -1;

    if (level >= 2 && Math.random() < 0.4) {
        do {
            activeRed = Math.floor(Math.random() * circles.length);
        } while (activeRed === activeGreen);
        circles[activeRed].classList.add("red");
    }

    if (level === 3 && Math.random() < 0.3) {
        do {
            activeYellow = Math.floor(Math.random() * circles.length);
        } while (
            activeYellow === activeGreen ||
            activeYellow === activeRed
        );
        circles[activeYellow].classList.add("yellow");
    }
}

function startGame(selectedLevel) {
    level = selectedLevel;
    startScreen.style.display = "none";
    gameArea.style.display = "flex";

    score = 0;
    timeLeft = GAME_TIME;

    scoreText.textContent = "Poäng: 0";
    messageText.textContent = "Tid: " + timeLeft + " s";

    setTargets();

    timer = setInterval(() => {
        timeLeft--;
        messageText.textContent = "Tid: " + timeLeft + " s";
        if (timeLeft <= 0) endGame();
    }, 1000);
}

function endGame() {
    clearInterval(timer);
    messageText.textContent = "Tiden är slut!";
}

/* Klick */
circles.forEach((circle, index) => {
    circle.addEventListener("click", () => {

        if (timeLeft <= 0) return;

        if (index === activeGreen) {
            score += 1;
            soundGreen();
        }

        if (index === activeRed) {
            score -= 1;
            soundRed();
        }

        if (index === activeYellow) {
            score += 2;
            soundYellow();
        }

        scoreText.textContent = "Poäng: " + score;
        setTargets();
    });
});
</script>

</body>
</html>